# Правила Поддержки Документации

Этот документ является инструкцией для AI-агента по кодированию. Он определяет протоколы и триггеры для автоматического обновления всей проектной документации (`gap.md`, `requirements.md`, `backlog.md`, `roadmap.md`, `sprint-plan.md`) для поддержания ее в актуальном состоянии.

## 1. Триггеры для Обновления Документации

Обновление документации должно быть инициировано при наступлении одного из следующих событий:

1.  **Завершение Задачи:** `git commit` с сообщением, содержащим ключевое слово `closes TSK-X.Y`, где `TSK-X.Y` — ID задачи из `sprint-plan.md`.
2.  **Завершение Истории Пользователя:** Все задачи, связанные с одним `ID Истории` в `sprint-plan.md`, помечены как `DONE`.
3.  **Завершение Эпика:** Все Истории Пользователя, принадлежащие одному Эпику в `backlog.md`, помечены как `DONE`.

## 2. Протокол Обновления

Агент должен выполнять следующие действия в строгой последовательности.

### Протокол A: При завершении Задачи (например, `TSK-2.2`)

1.  **Найти Задачу:** Открыть `sprint-plan.md` и найти строку с задачей `TSK-2.2`.
2.  **Обновить Статус Задачи:** Добавить в таблицу столбец `Статус` (если отсутствует) и установить значение `DONE` для этой задачи.
3.  **Определить ID Истории:** Из той же строки извлечь `ID Истории` (например, `US-QC-2`).
4.  **Проверить Статус Истории:** Проверить статусы всех остальных задач, связанных с `ID Истории` `US-QC-2`.
5.  **Инициировать следующий протокол:** Если все задачи для `US-QC-2` имеют статус `DONE`, немедленно запустить **Протокол B** для `ID Истории` `US-QC-2`.

### Протокол B: При завершении Истории Пользователя (например, `US-QC-2`)

1.  **Найти Историю:** Открыть `backlog.md` и найти таблицу Историй Пользователя для соответствующего Эпика. Найти строку с `ID Истории` `US-QC-2`.
2.  **Обновить Статус Истории:** Добавить в таблицу столбец `Статус` (если отсутствует) и установить значение `DONE`.
3.  **Определить ID Требований:** Из той же строки извлечь все связанные `Req. ID` (например, `REQ-DEPS-1`, `REQ-DEPS-2`).
4.  **Обновить Статус Требований:** Для каждого `Req. ID`:
    a. Открыть `requirements.md` и найти строку с этим `ID`.
    b. Проверить в `backlog.md`, существуют ли *другие* истории со статусом, отличным от `DONE`, которые ссылаются на этот же `Req. ID`.
    c. Если других историй нет, или все они `DONE`, изменить `Статус` требования в `requirements.md` на `IMPLEMENTED`.
    d. В противном случае, изменить `Статус` на `PARTIAL`.
5.  **Проверить Статус Эпика:** Определить, к какому Эпику относится история `US-QC-2` (например, `EPIC-QC`). Проверить статусы всех остальных историй в этом эпике.
6.  **Инициировать следующий протокол:** Если все истории для `EPIC-QC` имеют статус `DONE`, немедленно запустить **Протокол C** для `EPIC-QC`.

### Протокол C: При завершении Эпика (например, `EPIC-QC`)

1.  **Найти Эпик:** Открыть `backlog.md` и найти заголовок Эпика `EPIC-QC`.
2.  **Обновить Статус Эпика:** Добавить к заголовку маркер завершения: `## EPIC-QC: ... [DONE]`.
3.  **Обновить Roadmap:**
    a. Открыть `roadmap.md` и найти Фазу, содержащую `EPIC-QC` (например, `Phase 1`).
    b. Проверить, завершены ли все остальные эпики в этой фазе.
    c. Если да, добавить к заголовку фазы маркер: `### Phase 1: ... (COMPLETED)`.
4.  **Обновить Gap Analysis:**
    a. Открыть `gap.md`.
    b. Найти разделы, связанные с требованиями, которые были закрыты в рамках этого эпика.
    c. Добавить в конце каждого соответствующего раздела пометку `[RESOLVED]`.

## 3. Правила Проверки Консистентности

## 4. EPIC-PARSER: Парсер Спецификаций из Файлов Чата [DONE]

Все истории пользователей, связанные с EPIC-PARSER, были успешно реализованы и протестированы. Новая функциональность "Парсер спецификаций" полностью готова к использованию.

Основные достижения:
- Реализован движок парсинга чата для извлечения структурированных документов
- Создан пользовательский интерфейс с отдельной вкладкой "Парсер спецификаций"
- Добавлена функциональность загрузки файлов и отображения логов обработки
- Реализована возможность скачивания всех сгенерированных документов в виде zip-архива
- Созданы и успешно пройдены все необходимые тесты

Требования, реализованные в рамках этого эпика:
- REQ-PARSER-1: Реализация UI для загрузки файлов чата [IMPLEMENTED]
- REQ-PARSER-2: Создание отдельной вкладки для парсера [IMPLEMENTED]
- REQ-PARSER-3: Извлечение структурированных документов из содержимого чата [IMPLEMENTED]
- REQ-PARSER-4: Отображение логов обработки в реальном времени [IMPLEMENTED]
- REQ-PARSER-5: Функциональность скачивания всех документов одним архивом [IMPLEMENTED]

Агент должен периодически выполнять следующие проверки для предотвращения рассинхронизации.

1.  **Проверка Трассировки "Вперед":** Перед началом работы над любой задачей из `sprint-plan.md`, убедиться, что `ID Истории`, указанный для нее, существует в `backlog.md`, и что `Req. ID`, указанный для этой истории, существует в `requirements.md`. При расхождении — остановить выполнение и выдать ошибку.
2.  **Проверка Трассировки "Назад":** Еженедельно сканировать `requirements.md`. Если требование имеет статус `IMPLEMENTED`, проверить, что все связанные с ним истории в `backlog.md` имеют статус `DONE`. При расхождении — выдать предупреждение о неконсистентности.
3.  **Проверка Целостности Спринта:** Перед началом нового спринта убедиться, что все `ID Истории` в новом плане спринта существуют в `backlog.md` и не имеют статус `DONE`.